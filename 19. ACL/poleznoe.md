# ACL
_ _ _
___ACL (Access Control List)___  — это ряд команд IOS, определяющих, пересылает ли маршрутизатор пакеты или сбрасывает их, исходя из информации в заголовке пакета.
  
___Некоторые задачи, выполняемые маршрутизаторами, требуют использования списков ACL для идентификации трафика:___
- Ограничение сетевого трафика для повышения производительности
сети.
- Управление потоком трафика.
- Списки контроля доступа обеспечивают базовый уровень безопасности в отношении доступа к сети.
- Фильтрация трафика на основе типа трафика.
- Проверка хостов в целях разрешения или запрета доступа к сетевым
сервисам.
- Предоставление приоритета определенным классам сетевого трафика
  
___Список контроля доступа (ACL)___ — это последовательный список разрешающих или запрещающих операторов, называемых записями списка контроля доступа (ACE).При прохождении сетевого трафика через интерфейс, где действует список контроля доступа (ACL), маршрутизатор последовательно сопоставляет информацию из пакета с каждой записью в списке контроля доступа на предмет соответствия. Этот процесс называется фильтрацией пакетов. Списки контроля доступа определяют набор правил, обеспечивающих дополнительный контроль над пакетами, которые принимаются интерфейсами, транзитными пакетами, которые передаются через маршрутизатор, а также пакетами, которые отправляются из интерфейсов маршрутизатора.
  
ACL при создание находится только в оперативной памяти,для того чтобы он начал выполнять свою функцию его нужно привязать к интерфейсу, ACL устанавливается либо на входящий трафик, либо на исходящий:
- Входящий ACL фильтрует пакеты, приходящие на определенный интерфейс, до того, как они будут направлены на исходящий интерфейс. Входящий ACL-список эффективен, поскольку он сохраняет ресурсы на поиск маршрута, если пакет сбрасывается.
- Исходящий ACL фильтрует пакеты после их маршрутизации — вне зависимости от входящего интерфейс
  
___Ограниченное число списков ACL на интерфейсе___
Существует ограничение на количество списков ACL, которые могут быть применены к интерфейсу маршрутизатора. Например, интерфейс с двойным стеком маршрутизатора (например, IPv4 и IPv6) может иметь до четырех ACL, как показано на рисунке.
В частности, интерфейс маршрутизатора может иметь:
- один исходящий список ACL IPv4
- один входящий список ACL IPv4
- один входящий список ACL IPv6
- один исходящий список ACL IPv6
  
___Виды ACL:___
- Стандартные - фильтруют только на уровне 3, используя только адрес источника IPv4.
- Расширенные - фильтр ACL на уровне 3 с использованием адреса IPv4 источника и/или назначения. Они также могут фильтровать на уровне 4, используя порты TCP, UDP и дополнительную информацию о типе протокола для более точного управления.
- Динамические
- Рефлексивные
- Повременные
  
___Обзор шаблонных масок ACL списков___
Шаблонная маска аналогична маске подсети в том, что она использует процесс логического И для определения того, какие биты IPv4-адреса соответствуют. В отличии от маски подсети, в которой 1 определяет совпадение, а 0 определяет не совпадение в шаблонной маске - верно обратное.
- IPv4 ACE использует 32-разрядную шаблонную маску, чтобы определить, какие биты адреса необходимо проверить на соответствие.
- Для совпадения двоичных единиц и нулей шаблонные маски используют следующие правила:
- Бит 0 шаблонной маски — совпадает с соответствующим значением бита в адресе.
- Бит 1 шаблонной маски — игнорирует соответствующее значение бита в адресе.

Подробнее об шаблонной маске можно почитать тут https://habr.com/ru/articles/131712/
  
## ACL standart
_ _ _
Когда ACL применяется к интерфейсу, он выполняет определенную рабочую процедуру. Ниже приведены действия, используемые при поступлении трафика в интерфейс маршрутизатора с настроенным входящим стандартным ACL IPv4.
1. Если на маршрутизаторе настроен стандартный список контроля доступа (ACL) IPv4, то, получив пакет, такой маршрутизатор извлекает из заголовка пакета IPv4- адрес источника.
2. Далее маршрутизатор последовательно сравнивает адрес с адресом в каждой из записей в списке контроля доступа (ACL), начиная с первой записи.
3. Когда сопоставление установлено, маршрутизатор выполняет инструкцию, разрешающую или запрещающую пакет, а остальные ACE в ACL, если таковые имеются, не анализируются.
4. Если исходный IPv4-адрес не совпадает ни с одним ACE в ACL, пакет отбрасывается, поскольку существует неявный запрет ACE, автоматически применяемый ко всем ACL.
  

Последней записью ACL-списка всегда является косвенный отказ, блокирующий весь трафик. Он скрыт и не отображается в конфигурации. ___Примечание. ACL должен иметь по крайней мере одну инструкцию разрешения, иначе весь трафик будет отклонен из-за неявного оператора deny ACE.___
  
```
R1(config)#ip acces-list standart TEST - создали стандартный ACL 
R1(config)# interface g0/0/1
R1(config-if)#ip access-group TEST in или out - привязали ACL к интерфейсу
R1(config-if)#no ip access-group TEST in или out - отвязать ACL с интерфейса. ___ВАЖНО ! Нельзя удалять ACL без отвязки от интерфейса!___
```
- Для просмотра конфигурации ACL используйте команду ___show running-config___
- Для проверки правильности применения списка контроля доступа к интерфейсу используйте команду ___show ip interface___
- Для просмотра конфигурации ACL используйте команду ___show access-list___
- Для очистки счетчиков ACL используйте команду  ___clear access-list counters___
  
### Редактирование ACL
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/19.%20ACL/Redaktirovanie_ACL.PNG">
  
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/19.%20ACL/Redaktirovanie_ACL_2.PNG">
  
### Настройка ACL для фильтрации трафика VTY
  

<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/19.%20ACL/ACL_VTY.PNG">

  
## ACL extended
_ _ _

Расширенный ACL отличается тем, что маршрутизатор будет заглядывать глубже в IP пакет, а именно в сегмент (TCP/UDP) тем самым можно настроить фильтрацию более тонко, к примеру заблокировать доступ к определенной службе.
```
R1(config)#ip access-list extended TEST - создать расширенный ACL
R1(config-ext-nacl)#permit(разрешить) tcp(протокол) any(IP источника) any(IP назначения) eq(ровно) 23(порт службы) - синтаксис
R1(config)#interface gigabitEthernet 0/0/0
R1(config-if)#ip access-group TEST in - привязать ACL на интерфейс (in - на вход, out - на выход)
```
  
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/19.%20ACL/established.PNG">
  
```
R1(config-ext-nacl)#permit tcp any 192.168.10.0 0.0.0.255 established - ACL настроен так, чтобы разрешить возврат веб-трафика, только на внутренние узлы
```
  
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/19.%20ACL/firewall.PNG">
