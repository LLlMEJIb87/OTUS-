## Уровень 2: Канальный.

__Канальный уровень (data link layer)__ предназначен для обеспечения взаимодействия сетей на физическом уровне и контроля за ошибками, которые могут возникнуть. Канальный уровень берет пакеты , полученные с сетевого уровня, и вставляет их в фреймы для передачи. В каждом фрейме содержится **Заголовок**, **Пользовательские данные** и **Трейлер** . Фреймы имеют жесткое ограничение максимальной длины, связанное с аппаратными требованиями.    

__Основные задачи,службы,цели канального уровня:__
1. Управление фреймами - это основная задача канального уровня
2. Форматирование данных - преобразование необработанных битов данных в структуированные кадры
3. Обнаружение и исправление ошибок
4. Управление доступом к среде -контроль доступа к общему физическому средству передачи,  предотвращение коллизий
5. Адресация - использование MAC адресов для идентификации устройств в локальной сети

__Формирование Фрейма__    
Канальный уровень разделяет поток битов на отдельные фреймы и вычисляет для каждого  из них короткий маркер - __контрольная сумма__ . КС добавляется во Фрейм перед тем, как он пересылается дальше.    

В протоколах **Ethernet** и **802.11** Фрейм  начинается с четко определнного шаблона **Преамбула** - упрощает адресату задачу приема пакета. Вслед за Преамбулой в заголовке передается  __поле длины (счетчик битов)__ - он нужен для обнаружения конца фрейма    

**CRC** - циклический избыточный код, метод обнаружения ошибок используемый на канльном уровне

Спецификация IEEE 802 разделяет этот уровень на два подуровня: MAC (Media Access Control) регулирует доступ к разделяемой физической среде, LLC (logical link control) обеспечивает обслуживание сетевого уровня.

Основные протоколы используемые на канальном уровне: IEEE 802.3 (Ethernet), IEEE 802.11 wireless LAN, PPP

В программировании этот уровень представляет драйвер сетевой платы, в операционных системах имеется программный интерфейс взаимодействия канального и сетевого уровней между собой. 

## Подуровень MAC
__MAC (Medium Acess Control)__ управление доступом к среде -  протокол множественного доступа, который позволяет нескольким станциям делить между собой одну среду передачи данных, к которой они подключены.MAC обеспечивает адресацию и механизмы управления доступом к каналам, что позволяет нескольким терминалам или точкам доступа общаться между собой в многоточечной сети

## Подуровень LLC
__LLC ( Logical Link Control)__ - отвечает за управление логическими соединениями, кадрами и контроль ошибок, обеспечивая интерфейс между сетью и MAC подуровнем

## PPP
Point-to-Point Protocol - протокол двухточечного соединения, механизм формирования фреймов. Он обнаруживает ошибки, поддерживает нексколько протоколов, разрешает аутентификцацию и др. Используется в качестве трех основных методов:
1. Метод формирования фреймов
2. LCP протокол управления каналом, позволяющий устанавливать соединения, тестировать их, договариваться о параметрах.
3. NCP - сетевой протокол управления ( для каждого сетевого уровня имеется свой)

<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/4.%20Data%20link.%20Ethernet/PPP.PNG">
</p>    

1. Cтандартный фалоговый байт 01111110 (1 байт)
2. Адресс 11111111 -все станции должны принимать этот фрейм (1 байт)
3. Управляющее поле 00000011 - означает ненумерованный фрейм (1 байт)
4. Протокол - определяет тип пакета, который содержится в PlayLoad (1 или 2 байт) (если в начале идет 0 - речь о сетевом уровне, если 1 - конфигурационные протоколы (служебные))
5. Контрольная сумма (2 или 4 байта)

__Установка соединения PPP__

<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/4.%20Data%20link.%20Ethernet/PPP_connected.PNG">
</p>    

1. Dead - соединения на физическом уровне не существует     
2. Establish - установление соединения ( В этот момент начинаются переговоры о параметрах с помощью протокола LCP     
3. AUTHENTICATE - аутентификация ( обе стороны при желание могут проверить кем является собеседник)     
4. Network - происходит обмен пакетами  NCP  для настройки сетевого уровня     
5. Open - можно начинать передачу данных     
6. Terminate - переход в это состояние после окончания передачи данных    

## Ethernet.
__Ethernet__ - технология для объеденения устройств в сеть.

<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/4.%20Data%20link.%20Ethernet/frame.PNG">
</p> 

### Ethernet. 802.1Q VLAN

<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/4.%20Data%20link.%20Ethernet/dot1q.PNG">
</p>    


Добавлены 2 2х байтных поля:
1. Идентификатор протокола ТЭГА TPID (2 байта) всегда 0x8100
2. Tag Control Information (2 байта)
- VLAN ID (12 бит) - идентификатор vlan
- Priority (3 бит) - приоритет ( позволяет различать трафик реального времени и трафик для которого время не критично)
- CFI (1 бит) - индикатор классического формата



## WI-FI 802.11
Cпособ передачи данных в беспроводной среде. В отличие от ethernet радиопередатчики устройств работают в полудуплексном режиме. Wi-FI использует протокол CSMA/CA для предотвращения коллизий в сети, так же используется связь с подтверждением доставки     

__Cтруктура Фрейма__   

<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/4.%20Data%20link.%20Ethernet/frame_WI-FI.PNG">
</p>      

1. Frame control ( 2 байта)
- Версия протокола ( 2 бита)
- Тип ( 2 бита ) (Информационный, Служебный или управляющий)
- Подтип ( 4 бита) ( RTS или СTS)
- To DS (1 бит) в сеть 
- From DS ( 1 бит) из сети
- More Fragments - (1 бит) сообщает,что далее следует еще фрагмент
- Rety ( 1 бит) - Маркирует вновь отправленный фрейм
- Power Menedgment ( 1 бит) - указывается клиентом при переходе в спящий режим или выходе из него
- More Data ( 1 бит) - говорит о том, что у отправителя есть еще фреймы для пересылки
- Protected ( 1 бит) - является индикатором использования шифрования в теле фрейма
- Order ( 1 бит) - говорит приемнику о том, что фреймы с этим битом должны обрабатоваться строго по порядку
2. Duration (2 байта) - в нем задается время в микросекундах, которое будет потрачено  на передачу фрейма и подтверждения
3. Destenation Address ( 6 байт)
4. Source Address ( 6 байт)
5. AP Address (6 байт) - при использование ретранслятора ( адрес конечной точки)
6. Sequence (2 байта) - нумерует фрагменты (позволяет выявить дубликаты)
7. Data ( 0 - 2312 байт) - данные
8. Frame check Sequence (4 байта) - контрольная последовательсность фрейма.


### [ Уровень 3: Сетевой.](https://github.com/LLlMEJIb87/OTUS-learning/tree/master/5.%20Network%20layer.%20IP)
