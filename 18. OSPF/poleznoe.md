# OSPF
_ _ _
OSPF (англ. Open Shortest Path First) — протокол динамической маршрутизации, основанный на технологии отслеживания состояния канала (link-state technology) и использующий для нахождения кратчайшего пути алгоритм Дейкстры.
  
В Link-state протоколах каждый маршрутизатор должен непросто знать самые лучшие маршруты во все удалённые сети, но и иметь в памяти полную карту сети со всеми существующими связями между другими маршрутизаторами в том числе. Это достигается за счет построения специальной базы LSDB
  
Маршрутизаторы, использующие OSPF, обмениваются сообщениями для
передачи информации о маршрутизации с использованием пяти типов
пакетов: 
- пакет приветствия (hello) - выполняет обнаружение соседних узлов и устанавливает отношения смежности между ними
- пакет описания базы данных (DBD) - проверяет синхронизацию баз данных между маршрутизаторами
- пакет состояния канала (LSR) - запрашивает записи о состояниях определенных каналов на различных маршрутизаторах
- пакет обновления состояния канала (LSU) - отправляет запрашиваемые записи о состоянии канала
- пакет подтверждения состояния канала (LSAck) - подтверждает другие типы пакетов
  
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/18.%20OSPF/komponenti.PNG">
  
Ниже приведены шаги, которые выполняются маршрутизатором
1. Установление отношений смежности с соседними устройствами, чтоб соседство состоялось важно, чтобы в конфигурации OSPF на обоих маршрутизаторах были одинаковыми следующие параметры:
- Hello Interval — частота отправки сообщений Hello
- Router Dead Interval — период времени, по прохождению которого, сосед считается недоступным, если не было Hello.
- Area ID — соседство может установится только посредством интерфейсов в одной зоне.
- Authentication — пароль использующийся для аутентификации и тип аутентификации, если он есть.
2. Обмен объявлениями о состоянии каналов
3. Создание базы данных состояния связи
4. Исполнение алгоритма SPF
5. Выбор лучшего маршрута
  
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/18.%20OSPF/sostoyania.PNG">
  
Включение и конфигурация OSPF на маршрутизаторе режим point-to-point:
1. Router ospf process-id (может быть любым от 1 до 65535, рекомендуется присваевать один и тот номер процесса всем маршрутизаторам OSPF)
2. Router-id rid ( задать индентификатор в ручную используя 32 битный адрес ipv4, если не задавать то id будет адрес loopback интерфейса)

Способ 1:
```
R1(config)#router ospf 1 - включили OSPF на маршрутизаторе
R1(config-router)#router-id 1.1.1.1 - задали идентификатор
R1(config-router)#passive-interface default - перевели все интерфейсы в пассивный режим (делается в сторону клиентов)
R1(config-router)#no passive-interface g0/0 - отключили пассивный режим на пограничных интерфейсах
R1(config-router)#no passive-interface g0/1
R1(config-router)#network 192.168.1.0 0.0.0.255 area 0 - задали на каком интерфейсе включить процесс OSPF, указав сети привязанные к интерфейсу
R1(config-router)#network 10.0.1.0 0.0.0.255 area 0 
R1(config-router)#network 10.0.2.0 0.0.0.255 area 0
R1(config)#exit
R1(config)#interface range g0/0-1
R1(config-if-range)#ip ospf network point-to-point - указали, что интерфейсы используются для подключения к другим маршрутизаторам.
```

Способ 2:
```
R2(config)#router ospf 1 - включили OSPF на маршрутизаторе
R2(config-router)#router-id 2.2.2.2 - задали идентификатор
R2(config-router)#network 10.0.1.2 0.0.0.0 area 0 - задали на каком интерфейсе включить процесс OSPF, указав ip интерфейса
R2(config-router)#network 10.0.1.2 0.0.0.0 area 0 
```
  
Cпособ 3:
```
R3(config)#router ospf 1 включили OSPF на маршрутизаторе
R3(config-router)#router-id 3.3.3.3 задали идентификатор
R3(config-router)#exit
R3(config)#interface gigabitEthernet 0/2 
R3(config-if)#ip ospf 1 area 0 - включили интерфейс в процесс OSPF
R3(config)#exit
R3(config)#interface gigabitEthernet 0/1
R3(config-if)#ip ospf 1 area 0
R3(config-if)#exit
R3(config)#interface gigabitEthernet 0/0
R3(config-if)#ip ospf 1 area 0
```

```
R3#show ip ospf neighbor - покажет граничиющие маршрутизаторы
```

### OSPF сеть с коллективным доступом.
  
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/18.%20OSPF/broadcast_ospf.PNG">
</p>
  
Сети OSPF с коллективным доступом уникальны тем, что один маршрутизатор управляет распределение LSA. Маршрутизатор выбранной для этой роли, должен быть определен администратором сети с помощью правильной настройки.