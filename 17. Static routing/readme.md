# Принципы маршрутизации. Статическая маршрутизация.
_ _ _

## FIB и RIB
Говоря о механизмах заполнения таблицы маршрутизации стоит ввести два термина:
- RIB ( Routing Information Base) - Таблица маршрутизации
  
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/17.%20Static%20routing/RIB.PNG">
</p>
  
Маршруты на маршрутизатор могут попадать из различных источников: быть настроены статически, попадать из протоколов динамической маршрутизации OSPF, BGP и т.д. При этом из различных источников могут приходить маршруты с одним и тем-же префиксом. Из этих маршрутов нужно выбрать какой-то один и добавить его в FIB. Эта задача как раз и решается в RIB. Обычно маршрутам из разных источников присваивается разная Административная Дистанция и наилучшим считается маршрут с наименьшей Административной Дистанцией. Важно, что конкурируют между собой маршруты с одним и тем-же префиксом. Маршруты с разными префиксами между собой не сравниваются. Например, префиксы 10.0.0.0/8 и 10.0.0.0/16 это разные префиксы и в FIB попадут оба маршрута. Таким образом, в RIB выполняется поиск КОНКРЕТНОГО префикса. Поиск префиксов в RIB выполняется при добавлении или удалении маршрутов, что происходит относительно редко.
  
__Данные в RIB живут на уровне Control Plane__
  
- FIB (Forwarding Information Base) Таблица форвардинга
  
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/17.%20Static%20routing/FIB.PNG">
</p>
  
FIB служит собственно для маршрутизации ip-пакетов. Здесь лучшим маршрутом считается маршрут с наиболее длинным префиксом, совпадающим с адресом назначения в ip-пакете. Поиск лучшего маршрута в FIB происходит для каждого нового ip-пакета. От того, насколько эффективно происходит поиск маршрута в FIB напрямую зависит скорость маршрутизации устройства. Поэтому поиск в FIB должен производиться максимально быстро и эффективно. В FIB может содержаться несколько сот тысяч маршрутов с разными префиксами, поэтому задача выглядит довольно нетривиальной. Для ее оптимизации было предложено много различных алгоритмов
  
__Совместная работа RIB и FIB показана на изображение ниже:__
  
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/17.%20Static%20routing/FIB%26RIB.PNG">
</p>

## Маршрутизация и форвардинг
__Основная задача__ определить в каком именно сегменте находится хост получатель.
  
Решается логичискеми операциями: dst IP addr и pref mask <> pref IP addr. Берется dst IP addr из IP пакета, далее берем какой-либо preffix, берем от pref маску накладываем на dst IP addr и полученный результат сравниваем с prefix, там где есть совпадение в ту сторону пакет и будет отправляться
  
__Маршрут по умолчанию (default route)__ наименее специфичный маршрут 0.0.0.0/0, который используется когда нет других более предпочтительных (более специфичных) маршрутов
  
__Шлюз по умолчанию (default gateway)__ - маршрутизатор, через который данный сегмент сети связан со всей остальной сетью. В маршруте по умолчанию в качестве nexthope указан шлюз по умолчанию.
  
## Статическая маршрутизация
  
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/17.%20Static%20routing/topologia.PNG">
</p>
  

В статическом маршруте следующего перехода указывается только IP адрес следующего перехода. Выходной интерфейс определятся исходя из следующего транзитного участка.
```
R1(config)#ip route 172.16.1.0 255.255.255.0 172.16.2.2
R1(config)#ip route 192.168.1.0 255.255.255.0 172.16.2.2
R1(config)#ip route 192.168.2.0 255.255.255.0 172.16.2.2
```
```
R1(config)#ipv6 unicast-routing
R1(config)#ipv6 route 2001:db8:acad:1::/64 2001:db8:acad:2::2
R1(config)#ipv6 route 2001:db8:cafe:1::/64 2001:db8:acad:2::2
R1(config)#ipv6 route 2001:db8:cafe:2::/64 2001:db8:acad:2::2
```
При указание link-local адреса перехода нужно так же указывать сам интерфейс
```
R1(config)#ipv6 route 2001:db8:acad:1::/64 s0/1/0 fe80::2
```
  
- __show ip route__ покажет таблицу маршрутизации
- __show ip route static__ покажет только статические маршруты
- __show ip route network__ покажет запись для конкретной сети
- __show ip route | begin Gateway__ отфильтрует и покажет только интерфейсы шлюзов
- __show running-config | section ip route__ покажет настройки маршрутизации в конфиге
  
__При настройки интерфейсов точка-точка, допускается следующий ввод команд__
```
R1(config)#ip route 172.16.1.0 255.255.255.0 s0/1/0
R1(config)#ip route 192.168.1.0 255.255.255.0 s0/1/0
R1(config)#ip route 192.168.2.0 255.255.255.0 s0/1/0
```
  
__При настройки перехода broadcast сетей можно использовать следующие команды:__
```
R1(config)#ip route 172.16.1.0 255.255.255.0  g0/0/1 172.16.2.2
R1(config)#ip route 192.168.1.0 255.255.255.0 g0/0/1 172.16.2.2
R1(config)#ip route 192.168.2.0 255.255.255.0 g0/0/1 172.16.2.2
```
  
__Настройка плавающего статического маршрута__ (используется как резервный в случае проблем с основным)
```
R1(config)#ip route 0.0.0.0 0.0.0.0 172.16.2.2
R1(config)#ip route 0.0.0.0 0.0.0.0 10.10.10.2 5
```
  

