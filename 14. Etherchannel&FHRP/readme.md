# Избыточность линков (Etherchannel) 
_ _ _
Etherchannel — это технология, позволяющая объединять (агрегировать) несколько физических проводов (каналов, портов) в единый логический интерфейс. Как правило, это используется для повышения отказоустойчивости и увеличения пропускной способности канала. 
  
Агрегирование будет выполнено в следующих случаях:
1. Одинаковый Duplex
2. Одинаковая скорость интерфейсов
3. Одинаковые Vlan и Native Vlan
4. Одинаковый режим интерфейсов (access, trunk)
5. Максимальное кол-во портов, которые можно объединить - 8

## Протокол агрегации портов LACP
1. Для того, чтобы протокол заработал, его нужно перевести в режим:
- active сразу включает протокол, активно запрашивает возможность и готовность к участию другой стороной
- passive включит протокол, если обнаружит LACP-сообщение от соседа
- ON участник канала без согласования (без протокола)

| Режим      | Active         | Passive |
| ------------- |:------------------:|:------------------:|
| Active    | Да | да | 
| Passive|  да | нет| 

2. Настройка протокола, команды:
```
S1(config)#interface gigabitEthernet 0/1 - заходим на интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - создаем интерфейс port-channel 1 (это и будет виртуальный интерфейс агрегированного канала) и переводим его в режим active
S1(config-if)#no shutdown  - включаем интерфейс
S1(config)#interface gigabitEthernet 0/2 - заходим на второй интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - определяем в port-channel 1
S1(config-if)#no shutdown  - включаем интерфейс
```
Настройка на первом коммутаторе окончена, проверить можно командой **_show_ _etherchannel_ _port-channel_** 
  

Переходим к настройке второго коммутатора
```
S2(config)#interface range gigabitEthernet 0/1-2 - переходим к настройке сразу нескольких интерфейсов.
S2(config-if-range)#shutdown - выключаем их
S2(config-if-range)#channel-group 1 mode passive - создаем port-channel и переводим в режим passive (включится, когда получит LACP-сообщение).
S2(config-if-range)#no shutdown - обратно включаем
````
После этого канал согласуется. Посмотреть на это можно командой **_show_ _etherchannel_ _summary_**
  
Если нам требуется изменить режим портов (trunk, access) либо прововести иные манипуляции, то это делается не с отдельным портом, а с интерфейсом portchannel:
```
Switch(config)#interface port-channel 1
Switch(config-if)#switchport mode trunk 
```
  
 При создании агрегированного канала надо не забывать, что внутри него физические интерфейсы и пропускают трафик именно они. Бывают случаи, что вроде канал агрегирован, все работает, но наблюдается ситуация, что весь трафик идет по одному интерфейсу, а остальные простаивают. Для распределения нагрузки есть технология load-balance (балансировка)
  
Более подробно информацию можно посмотреть по ссылку https://habr.com/ru/articles/334778/


# Избыточность маршрузизатора (FHRP)
_ _ _
Cемейство протоколов, предназначенных для создания избыточности шлюза по умолчанию. Общей идеей для данных протоколов является объединение нескольких маршрутизаторов в один виртуальный маршрутизатор с общим IP адресом. Этот IP адрес будет назначаться на хостах как адрес шлюза по умолчанию
  
##  VRRP (Virtual Router Redundancy Protocol)
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/14.%20Etherchannel%26FHRP/VRRP.PNG">
</p>
<div align="center">
