# Избыточность линков (Etherchannel) и шлюзов (FHRP)
_ _ _
Etherchannel — это технология, позволяющая объединять (агрегировать) несколько физических проводов (каналов, портов) в единый логический интерфейс. Как правило, это используется для повышения отказоустойчивости и увеличения пропускной способности канала. 
  
Агрегирование будет выполнено в следующих случаях:
1. Одинаковый Duplex
2. Одинаковая скорость интерфейсов
3. Одинаковые Vlan и Native Vlan
4. Одинаковый режим интерфейсов (access, trunk)
5. Максимальное кол-во портов, которые можно объединить - 8

## Протокол агрегации портов LACP
1. Для того, чтобы протокол заработал, его нужно перевести в режим:
- active сразу включает протокол, активно запрашивает возможность и готовность к участию другой стороной
- passive включит протокол, если обнаружит LACP-сообщение от соседа
- ON участник канала без согласования (без протокола)

| Режим      | Active         | Passive |
| ------------- |:------------------:|:------------------:|
| Active    | Да | да | 
| Passive|  да | нет| 

2. Настройка протокола, команды:
```
S1(config)#interface gigabitEthernet 0/1 - заходим на интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - создаем интерфейс port-channel 1 (это и будет виртуальный интерфейс агрегированного канала) и переводим его в режим active
S1(config-if)#no shutdown  - включаем интерфейс
S1(config)#interface gigabitEthernet 0/2 - заходим на второй интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - определяем в port-channel 1
S1(config-if)#no shutdown  - включаем интерфейс
```
Настройка на первом коммутаторе окончена, проверить можно командой show etherchannel port-channel
  
Переходим к настройке второго коммутатора
```
S2(config)#interface range gigabitEthernet 0/1-2 - переходим к настройке сразу нескольких интерфейсов.
S2(config-if-range)#shutdown - выключаем их
S2(config-if-range)#channel-group 1 mode passive - создаем port-channel и переводим в режим passive (включится, когда получит LACP-сообщение).
S2(config-if-range)#no shutdown - обратно включаем
````
После этого канал согласуется. Посмотреть на это можно командой show etherchannel summary

