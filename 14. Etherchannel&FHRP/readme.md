# Избыточность линков (Etherchannel) 
_ _ _
Etherchannel — это технология, позволяющая объединять (агрегировать) несколько физических проводов (каналов, портов) в единый логический интерфейс. Как правило, это используется для повышения отказоустойчивости и увеличения пропускной способности канала. 
  
Агрегирование будет выполнено в следующих случаях:
1. Одинаковый Duplex
2. Одинаковая скорость интерфейсов
3. Одинаковые Vlan и Native Vlan
4. Одинаковый режим интерфейсов (access, trunk)
5. Максимальное кол-во портов, которые можно объединить - 8

## Протокол агрегации портов LACP
1. Для того, чтобы протокол заработал, его нужно перевести в режим:
- active сразу включает протокол, активно запрашивает возможность и готовность к участию другой стороной
- passive включит протокол, если обнаружит LACP-сообщение от соседа
- ON участник канала без согласования (без протокола)

| Режим      | Active         | Passive |
| ------------- |:------------------:|:------------------:|
| Active    | Да | да | 
| Passive|  да | нет| 

2. Настройка протокола, команды:
```
S1(config)#interface gigabitEthernet 0/1 - заходим на интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - создаем интерфейс port-channel 1 (это и будет виртуальный интерфейс агрегированного канала) и переводим его в режим active
S1(config-if)#no shutdown  - включаем интерфейс
S1(config)#interface gigabitEthernet 0/2 - заходим на второй интерфейс
S1(config-if)#shutdown  - отключаем ( так как протокол STP может его заблокировать)
S1(config-if)#channel-group 1 mode active - определяем в port-channel 1
S1(config-if)#no shutdown  - включаем интерфейс
```
Настройка на первом коммутаторе окончена, проверить можно командой **_show_ _etherchannel_ _port-channel_** 
  

Переходим к настройке второго коммутатора
```
S2(config)#interface range gigabitEthernet 0/1-2 - переходим к настройке сразу нескольких интерфейсов.
S2(config-if-range)#shutdown - выключаем их
S2(config-if-range)#channel-group 1 mode passive - создаем port-channel и переводим в режим passive (включится, когда получит LACP-сообщение).
S2(config-if-range)#no shutdown - обратно включаем
````
После этого канал согласуется. Посмотреть на это можно командой **_show_ _etherchannel_ _summary_**
  
Если нам требуется изменить режим портов (trunk, access) либо прововести иные манипуляции, то это делается не с отдельным портом, а с интерфейсом portchannel:
```
Switch(config)#interface port-channel 1
Switch(config-if)#switchport mode trunk 
```
  
 При создании агрегированного канала надо не забывать, что внутри него физические интерфейсы и пропускают трафик именно они. Бывают случаи, что вроде канал агрегирован, все работает, но наблюдается ситуация, что весь трафик идет по одному интерфейсу, а остальные простаивают. Для распределения нагрузки есть технология load-balance (балансировка)
  
Более подробно информацию можно посмотреть по ссылку https://habr.com/ru/articles/334778/


# Избыточность маршрузизатора (FHRP)
_ _ _
Cемейство протоколов, предназначенных для создания избыточности шлюза по умолчанию. Общей идеей для данных протоколов является объединение нескольких маршрутизаторов в один виртуальный маршрутизатор с общим IP адресом. Этот IP адрес будет назначаться на хостах как адрес шлюза по умолчанию
  
##  VRRP (Virtual Router Redundancy Protocol)
<p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/14.%20Etherchannel%26FHRP/VRRP.PNG">
</p>

VRRP-маршрутизаторы объединяются в один виртуальный маршрутизатор. Все маршрутизаторы в группе имеют общий виртуальный IP (VIP) адрес и общий номер группы или VRID (Virtual Router Identifier). Один маршрутизатор может состоять в нескольких группах, каждая из которых должна иметь свою уникальную пару VIP/VRID.
  
Все маршрутизаторы делятся на два типа: VRRP Master и VRRP Backup:
- VRRP Master — это маршрутизатор, который занимается пересылкой пакетов для данного виртуальной группы
- VRRP Backup — это маршрутизатор, который ожидает пакет от Master. Если пакеты от Master перестают приходить, Backup пытается перейти в состояние Master
  
Подробные настройки VRRP можно посмотреть по ссылке https://microsin.net/adminstuff/cisco/vrrp.html
  
##  HSRP (Hot Standby Router Protocol)
Проприетарный протокол Cisco, предназначенный для увеличения доступности маршрутизаторов выполняющих роль шлюза по умолчанию. Это достигается путём объединения маршрутизаторов в standby группу и назначения им общего IP-адреса, который и будет использоваться как шлюз по умолчанию для компьютеров в сети.
  
Настройка протокола, команды:
- R1
```
Router(config)#interface gigabitEthernet 0/2 -заходим на интерфейс, который смотрит в локальную сеть
Router(config-if)#standby version 2 - активируем вторую версию протокола
Router(config-if)#standby 1 ip 192.168.3.254 - задаём ip адрес виртуального маршрутизатора
Router(config-if)#standby 1 priority 150 - задаем приоретет
Router(config-if)#standby 1 preempt - устанавливаем вытеснение
```
- R2
```
R2(config)#interface gigabitEthernet 0/2
R2(config-if)#standby version 2
R2(config-if)#standby 1 ip 192.168.3.254
```
  
Команда **_show_ _standby_** покажет информацию о протоколе.
  
Подробнее о протоколе можно почитать по ссылке http://xgu.ru/wiki/HSRP

