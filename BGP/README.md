# BGP
_ _  _
**BGP** (англ. Border Gateway Protocol, протокол граничного шлюза) — дистанционно векторный протокол динамической маршрутизации. Протокол BGP предназначен для обмена информацией о достижимости подсетей между автономными системами (АС, англ. AS — autonomous system), то есть группами маршрутизаторов под единым техническим и административным управлением.   

**BGP** не обнаруживает соседей автоматически – каждый сосед настраивается вручную.Процесс установления отношений соседства происходит следующим образом:
1. **IDLE** - значальное состояние BGP-соседства – IDLE. Ничего не происходит. BGP находится в соcтоянии IDLE, если нет маршрута к BGP-соседу.
2. **ACTIV/CONNECT** - Для обеспечения надёжности BGP использует TCP. BGP-маршрутизатор (их также называют BGP-спикерами/speaker или BGP-ораторами) слушает и посылает пакеты на 179-й TCP порт.
 - CONNECT - это состояние когда слушает
 - ACTIVE - это состояние когда отправил и ожидает ответа от соседа

В состоянии ACTIVE BGP может подвиснуть, если:
- нет IP-связности с R2
- BGP не запущен на R2
- порт 179 закрыт ACL

3. **OPEN** - после того, как TCP-сессия установлена, BGP-ораторы начинают обмен сообщениями. OPEN – первый тип сообщений BGP. Они отсылаются только в самом начале BGP-сессии для согласования параметров. В нём передаются версия протокола, номер AS, Hold Timer и Router ID. Чтобы BGP-сессия поднялась, должны соблюдаться следующие условия:
- версии протокола должна быть одинаковой
- Номера AS в сообщении OPEN должны совпадать с настройками на удалённой стороне
- Router ID должны различаться

Когда сообщение Open отправлено – это состояние **OPEN** **SENT.**    
Когда оно получено – это сотояние **OPEN** **CONFIRM.**    

  Получив OPEN от R1, R2 отправляет свой OPEN, а также KEEPALIVE, говорящий о том, что OPEN от R1 получен – это сигнал для R1 переходить к следующему состоянию – Established.

4. **ESTABLISHED** - псле всех  шагов выше они переходят в стабильное состояние

  Для обмена маршрутной информации маршрутизаторы отсылают сообщения **UPDATE**. Каждое сообщение UPDATE может нести информацию об одном новом маршруте или о удалении группы старых. Причём одновременно.    
  **UPDATE** передаются при каждом изменении в сети до тех пор пока длится BGP-сессия   
  <p align="center">
<image src="https://github.com/LLlMEJIb87/OTUS-learning/blob/master/BGP/Picture/BGP_UPDATE.PNG">
</p>

5. **KEEPALIVE** - каждый BGP-маршрутизатор регулярно будет рассылать сообщения KEEPALIVE. Как и в любом другом протоколе это означает: «Я всё ещё жив». Это происходит с истечением таймера Keepalive – по умолчанию 60 секунд.
