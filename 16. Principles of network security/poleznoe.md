# Принципы обеспечения безопасности сети
_ _ _
## Угрозы безопасности на уровне L2
  
Категории атак на коммутацию
- Атака на таблицу MAC - включает в себя атаки с переполнение таблицы CAM. Все таблицы MAC имеют фиксированный размер,и,следовательно коммутатор может исчерпать ресурсы для хранения MAC- адресов. Атаки с переполнением MAC-адресов используют это ограничение, отправляя фиктивные MAC-адреса источника до тех пор пока таблица MAC-адресов коммутатора не заполнится и коммутатор не сможет правильно работать дальше.
  Для нейтрализации данной атаки используют механизм защиты портов Port securrity
- Атаки на сети VLAN - включает в себя атаки с переходам по VLAN и QNQVLAN + атаки между устройтсвами в общей сети. VLAN Hopping, при этой атаки атакующий настраивает узел так,чтобы он действовал как коммутатор используя trunk порт.
  Для нейтрализации данной атаки требуется отключить транкинг на всех портах доступа, убедиться, что native vlan используется только для магистральных каналов
- Атаки, связанные с DHCP - включает спуфинг и атаку истощения ресурсов DHCP
- ARP атаки включает атаки подмены ARP и "отравление" ARP- кэша
  Данные атаки  нейтрализуются путем внедрения DAI
- Атаки с подменой адреса - включает атаки подмены MAC и IP адресов
  Данные атаки могут быть уменьшины путем внедрения IPSG
- Атаки STP - включает в себя атаки путем манипуляции протокола STP
  Данная атака нейтрализуется за счет реализации BPDU Guard на всех портах доступа
- LLDP - протокол канального уровня, позволяющий сетевому оборудованию оповещать оборудование, работающее в локальной сети, о своём существовании и передавать ему свои характеристики, а также получать от него аналогичные сведения.
  На абонентских портах следует отключать LLDP протокол.

### Port security
 Данная функция ограничивает количество допустимых MAC-адресов на один порт, а также функции безопасности портов позволяют администратору статически указывать MAC-адреса для порта или динамически определять ограниченное число MAC-адресов. Когда порт сконфигрурированный с защитой порта получает кадр, MAC адрес источника кадра сравнивается со списком MAC-адресов защищенного источника, которые были настроены или динамически изучены на порту. 
  
Port security настраивается только на портах доступа
```
S1(config)#switchport mode acces
S1(config)#switchport port-security
S1(config)#end
```
Командой __**show port-security**__ interface f0/1 можно посомтреть текущие настройка port security
  
Настройка особенностей port security:
S1(config)#switchport port-security ?
aging - можно указать в течение какого времени порт будет находится в режиме error-disable
mac-address - можем прописать в ручную статический mac - адрес
maximum - максимальное количество mac адресов на порту
violation - настроить, что будет происходить при нарушение
  
Коммутатор может быть настроен на изучение MAC-адресов на защищенном порту одним из трех способов
1. Ручная конфигурация - администратор в ручную настраивает  статический MAC-адрес
2. Динамическое изучение - когда вводится команда __**switchport port security**__, текущий MAC-адрес источника для устройства, подключенного автоматически защищается, но не добавляет вконфигурацию запуска. Если коммутатор перезагружен, порт должен будет повторно узнать MAC-адрес устройства.
3. Динамическое изучение - Sticky динамическое изучение MAC-адреса и привязка его к работающей конфигурации, команда __**switchport port-security mac-address sticky.
  
Если MAC-адрес устройства, подключенного к порту, отличается от списка защищенных адресов, происходит нарушение (Violation) порта, командой  __**switchport port-security violation {shutdown | restrict} устанавливается, что будет происходить при нарушение:
- shutdown - порт отключится по ошибке
- restrict - порт отбрасывает пакеты с неизвестными адресами источника 
  
__**show port-security address**__ покажет все защищенные MAC-адреса


### DHCP SNOOPING
Цель атаки на DHCP - истощение адресов, создать отказ в обслуживание, для подключения клиентов
  
Включение отслеживания DHCP:
1. ip dhcp snooping - включаем отслеживание в режиме global
2. ip dhcp snooping trust - включаем на доверенных портах ( за которыми находится dhcp сервер)
3. ip dhcp snooping limit rate -ограничиваем число сообщение обнаружения DHCP, которые могут приниматься в секунду на ненадежных портах
4. ip dhcp snooping vlan - включаем отслеживание DHCP по vlan
  
__**show ip dhcp snooping**__ - проверить настройки DHCP snooping
__**show ip dhcp snooping binding**__ просмотр клиентов, которые получили информацию DHCP


### ARP inspection
Чтобы предотварить подделку ARP и вызванное ею отравление ARP,коммутатор должен обеспечить передачу только действительных запросови ответов ARP
1. Включаем DHCP snooping в global
2. Включаем DHCP snooping на выбранных VLAN
3. Включаем DAI на выбранных VLAN
4. Настраиваем доверенные интерфейсы для DHCP snooping и проверки ARP
Все порты доступа настраиваются как ненадежные.
  
Пример настройки:
```
S1(config)#ip dhcp snooping
S1(config)#ip dhcp snooping vlan 10
S1(config)#ip arp inspection vlan 10
S1(config)#interface fa0/24
S1(config-if)#ip dhcp snooping trust
S1(config-if)#ip arp inspection trust
```
DAI также можно настроить для проверки MAC-адресов и IP адресов:
- Destination MAC -проверяет MAC-адрес назначения в заголовке Ethernet по отношению к целевому MAC-адресу в теле ARP
- Source MAC - проверяет MAC-адрес источника в заголовке Ethernet на соответсвие MAC-адреса отправителя в теле ARP
- IP address - проверяет тело ARP на наличие недопустимых и неожиданных адресов, включая адреса 0.0.0.0, 255.255.255.255 и все IP адреса многоадресной рассылки
  
Пример настройки:
```
S1(config)#ip arp inspection validate src-mac
S1(config)#ip arp inspection validate dest-mac
S1(config)#ip arp inspection validate ip
```
если нужно включить одновременно все команады, то :
```
S1(config)#ip arp inspection validate src-mac dest-mac ip
```
__**show run | include**__ validate покаэет настройки arp inspection

### Portfast и BPDU GUARD ( STP)
Чтобы нейтрализовать атаки манипуляций с протоколом STP, используются следующие средства защиты:
- Portfast - немедленно переводит интерфейс в состояние пересылки минуя состояния прослушивания и обучения, применяется ко всем портам доступа
```
S1(config)# interface fa0/1
S1(config-if)#switchport mode access
S1(config-if)#spanning-tree portfast
```
Или можем включить глобально ко всем портам доступа
```
S1(config)#spanning-tree portfast default
```

- BPDU Guard - защита немедленно отключает порт, который получает BPDU, настраивается только на портах доступа
```
S1(config)# interface fa0/1
S1(config-if)#switchport mode access
S1(config-if)#spanning-tree bpduguard enable
```
Или можем включить глобально ко всем портам доступа

```
S1(config)#spanning-tree portfast bpduguard default
```
  
__**show spanning-tree summary__** - покажет включен ли portfast глобально

__**show spanning-tree interface fa0/1__** - покажет включен ли portfast на интерфейсе