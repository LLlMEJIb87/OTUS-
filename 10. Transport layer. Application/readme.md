# Транспортный уровень
_ _ _

Транспортный уровень модели OSI (равно как и стека протоколов TCP/IP) обеспечивает следующие возможности:

1. Отслеживание индивидуальных сеансов общения между приложениями на передающем и принимающем устройствах.
2. Сегментация данных (разбиение больших порций данных на сегменты для индивидуальной отсылки по сети, сборка этих сегментов после получения).
3. Идентификация приложений, передающих и принимающих данные

Данные порождаются на уровне приложений конкретной пользовательской программой и передаются на транспортный уровень. Программа, как правило, знает ip адрес (или доменное имя) целевого устройства и предполагает, что на том конце должно быть запущено приложение, поддерживающее тот же самый протокол уровня приложений, что и на передающем устройстве. Все нюансы передачи в идеале должны быть сокрыты от разработчика, чтобы программист не занимался такими делами, как поиск маршрута к целевому устройству, надёжность доставки, установка соединений и т.п. Транспортный уровень — это первый уровень, который встречает данные приложения и начинает процедуру по их подготовке к передаче.
На транспортном уровне функционируют как правило два протокола: TCP и UDP. 

### Сегментация 
Первая задача, которую решают оба этих протокола — сегментация данных (Сегмент - единица данных, которую передает проткол на уровень IP). Когда программист пишет очередную программу, или разрабатывает новый протокол уровня приложений, он передаёт данные теми порциями, которыми ему удобно. Например, пользователь запрашивает по протоколу FTP файл размером 10 МБ, FTP сервер начинает отправку файла. При этом у сети есть ряд ограничений на объём передаваемой информации. Наиболее важное из них — это MTU (Maximum transmission unit) — характеристика уровня Data Link, означающая максимальный размер фрейма, который можно передать по сети. Естественно, что 10 мегабайтный файл не получится передать одним куском, нужно разбиение его на отдельные сегменты. Так же естественно, что программист не захочет заниматься такой типовой задачей, так как она не связана напрямую с логикой работы самого приложения. Вот тут к нам на помощи и приходит транспортный уровень.

1. Он берёт кусок данных с уровня приложений (в нашем примере те самые 10 мегабайт), разбивает его на сегменты подходящего для передачи размера,
2. К каждому может добавить информацию о порядковом номере сегмента для сборки в дальнейшем (если это протокол TCP)
3. Добавляет к каждому сегменту отдельный заголовок транспортного уровня
4. Передаёт сегмент ниже на сетевой уровень, где каждый сегмент обрабатывается индивидуально и запаковывается, например, в отдельный IP пакет.

### Идентификация приложений
Вторая важнейшая задача, лежащая на протоколах транспортного уровня — адресация индивидуальных приложений в масштабах передающего или принимающего устройств. Например, на одном сервере может работать несколько сетевых приложений: веб сервер, почтовый сервер, ssh сервер и т.п. Аналогично, пользователь может запустить на своём компьютере одновременно браузер, почтовую программу, skype и т.п. — задача транспортного уровня, передать полученную узлом информацию нужному приложению на этом узле. То есть, сетевой уровень нужен для того чтобы информация достигла узла, а транспортный — для того чтобы информация попала нужному приложению в пределах этого узла. Для такой идентификации приложений транспортерные протоколы (как TCP, так и UDP) используют номера портов: каждое приложение, желающее работать с сетью сообщает операционной системе о своих планах и регистрирует за собой какой-то номер порта. В последствии, когда на компьютер придут данные, транспортный уровень заглянет в поле «номер порта получателя» и передаст эти данные соответствующему приложению.

Порт — это числовая величина в пределах от 0 до 65535, условно диапазоны портов делятся на три категории:

1. Хорошо известные порты (well-known ports) — c 0 по 1023 — эти порты резервируются для самых популярных протоколов и приложений, которые исторически заняли свою нишу. Например, любой веб сервер обычно работает на 80-м порту, почтовый протокол SMTP использует 25 порт, SSH — 22-ой.
2. Зарегистрированные порты (registered ports) — с 1024 по 49151 — эти порты могут использоваться менее популярными приложениями, например, сетевыми играми, или более «молодыми» средствами связи, например, Skype. Тем не менее, и в этом блоке есть множество портов, которые можно назвать известными. Например, порт 8080 часто используется как альтернатива порту 80 для HTTP сервера.
3. Динамические или частные порты (dynamic or private ports) — с 49152 по 65535 — так же могут использоваться малоизвестными приложениями, но основное их использование — в качестве порта для клиентских программ. Например, когда вы обращаетесь к веб-серверу, ваш браузер выступает в качестве клиента. При этом на сервере вы будете обращаться к 80-му порту, а данные, приходящие в ответ вашему браузеру идут с 80-го порта на какой-то порт из этого диапазона, который динамически назначился вашему браузеру операционной системой.

### TCP

TCP (Transmission control protocol) — протокол, транспортного уровня, обеспечивающий надёжную доставку данных. Основные характеристики TCP:

1. Установка соединения (сессии)
2. Надёжная доставка (автоматическая пересылка потерявшихся сегментов)
3. Доставка сегментов и сборка их в том же порядке, в каком происходило сегментирование (так как разные сегменты запаковываются в индивидуальные пакеты, которые теоретически могли идти по сети разными маршрутами, в итоге сегменты могут прийти не в том порядке (reordering), в котором отправлялись. В этом случае TCP, тем не менее, соберёт их в правильном порядке).
4.Контроль потока (TCP может уменьшать скорость передачи информации в случае, если получатель не справляется с приёмом по причине ограниченности ресурсов).
Все эти характеристики позволяют снять множество задач с программиста, разрабатывающего протокол уровня приложений: ему не надо заботиться о надёжной доставке, о порядке обработки сегментов, об установке соединений. Тем не менее, благодаря этим функциям, TCP замедляет передачу сообщения. Это происходит по нескольким причинам: во-первых, узел получателя будет ждать, когда придут все отправленные сегменты, до того, как передать их приложению, во-вторых, сами сегменты содержат множество служебной информации, для того, чтобы обеспечить весь этот богатый функционал

__[ Подробнее об TCP ](https://ru.wikipedia.org/wiki/TCP)__
### UDP

Часто приложению нужна просто быстрая доставка и нет никаких требований по надёжности. Тут на помощь приходит протокол UDP. Его особенности — противоположность особенностям TCP. UDP отличается:

1. Отсутствием сессий.
2. Ненадёжной доставкой.
3. Отсутствием упорядочивания сегментов
4. Отсутствием контроля за скоростью передачи
5. Максимально возможной скоростью передачи данных за счёт всего вышеперечисленного.

UDP используется там, где важна скорость. Давайте рассмотрим два примера:

1. Человек загружает страничку, или, что более интересно, архив файла с сайта. Если потеряется хоть один сегмент, то скачивание архива не имеет смысла, так как он не распакуется. Точно так же, HTML вёрстка страницы не будет иметь никакого смысла, если из середины убрать некоторый кусок текста. В этом случае конечно используется TCP
2. Человек разговаривает по IP-телефону. Каждый кусок речевой информации должен приходить ровно в то время, когда его ожидают услышать (то есть между предыдущим и последующим), тут важно взаимодействие именно в реальном времени. Если какой-то кусок не дошёл, то проще просто игнорировать этот факт, чем ждать, когда его перешлют, так как в любом случае, когда он пришёл бы повторно, он был бы уже не нужен. В этой ситуации используется UDP.
Каждый протокол уровня приложений подразумевает использование определённого протокола транспортного уровня. Например, HTTP, SMTP, Telnet, SSH всегда работают по TCP. Radius, TFTP, RIP — всегда работают по UDP. Есть некоторые протоколы, которые в зависимости от ситуации могут работать как по TCP, так и по UDP. Например отправлять некоторую срочную информацию по UDP, а периодические важные обновления — по TCP.
__[ Подробнее об UDP ](https://ru.wikipedia.org/wiki/UDP)__
### ИТОГИ:
